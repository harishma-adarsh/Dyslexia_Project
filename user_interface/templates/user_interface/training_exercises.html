{% extends 'user_interface/base.html' %}

{% block title %}Training Exercises - Dyslexia Helper{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card mb-4">
            <div class="card-body text-center">
                <h2><span class="emoji">üïπÔ∏è</span> Fun Learning Exercises</h2>
                <p class="lead">Practice reading, writing, and pronunciation with interactive games!</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12 mb-3 text-end">
        <a class="btn btn-sm btn-outline-light" href="{% url 'training_exercises' %}?refresh=1">
            <i class="fas fa-shuffle"></i> Try different games
        </a>
    </div>
    {% for exercise in exercises %}
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card exercise-card h-100" data-url="{% url 'start_exercise' exercise.id %}">
            <div class="card-body">
                <div class="text-center mb-3">
                    {% if exercise.exercise_type == 'reading' %}
                    <i class="fas fa-book fa-3x text-primary"></i>
                    {% elif exercise.exercise_type == 'writing' %}
                    <i class="fas fa-pencil-alt fa-3x text-success"></i>
                    {% elif exercise.exercise_type == 'phoneme' %}
                    <i class="fas fa-microphone fa-3x text-warning"></i>
                    {% else %}
                    <i class="fas fa-brain fa-3x text-info"></i>
                    {% endif %}
                </div>

                <h5 class="card-title">
                    {{ exercise.name }}
                    {% if latest_detection %}
{% if exercise.exercise_type in 'reading,phoneme,comprehension' and latest_detection.dyslexia_probability > 0.4 %}
                    <span class="badge bg-danger float-end"><i class="fas fa-star"></i> Recommended</span>
                    {% elif exercise.exercise_type == 'writing' and latest_detection.dysgraphia_probability > 0.4 %}
                    <span class="badge bg-danger float-end"><i class="fas fa-star"></i> Recommended</span>
                    {% endif %}
                    {% endif %}
                </h5>
                <p class="card-text">{{ exercise.description }}</p>

                <div class="mb-3">
                    <span
                        class="badge bg-{% if exercise.difficulty_level == 'beginner' %}success{% elif exercise.difficulty_level == 'intermediate' %}warning{% else %}danger{% endif %}">
                        {{ exercise.get_difficulty_level_display }}
                    </span>
                    <span class="badge bg-info">
                        <i class="fas fa-clock"></i> {{ exercise.expected_duration }} min
                    </span>
                </div>

                {% if exercise.user_progress %}
                <div class="mb-3">
                    <div class="d-flex justify-content-between">
                        <small>Progress</small>
                        <small>{% widthratio exercise.user_progress.mastery_level 1 100 %}%</small>
                    </div>
                    <div class="progress">
                        <div class="progress-bar"
                            data-progress="{% widthratio exercise.user_progress.mastery_level 1 100 %}"></div>
                    </div>
                    <small class="text-muted">
                        <i class="fas fa-trophy"></i> Best: {% widthratio exercise.user_progress.best_score 1 100 %}% |
                        <i class="fas fa-repeat"></i> Attempts: {{ exercise.user_progress.attempts }}
                    </small>
                </div>
                {% else %}
                <div class="mb-3">
                    <small class="text-muted">New exercise - let's get started!</small>
                </div>
                {% endif %}

                <a class="btn btn-primary w-100" href="{% url 'start_exercise' exercise.id %}">
                    <i class="fas fa-play"></i> Start Exercise
                </a>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="card">
            <div class="card-body text-center">
                <i class="fas fa-gamepad fa-3x text-muted mb-3"></i>
                <h4>No exercises available yet</h4>
                <p class="text-muted">Check back soon for fun learning activities!</p>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h4><span class="emoji">üèÜ</span> Your Progress Summary</h4>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-3">
                        <div class="feature-icon">
                            <i class="fas fa-trophy text-warning"></i>
                        </div>
                        <h5>{{ user_progress_count }}</h5>
                        <p class="text-muted">Exercises Started</p>
                    </div>
                    <div class="col-md-3">
                        <div class="feature-icon">
                            <i class="fas fa-star text-success"></i>
                        </div>
                        <h5>{{ best_score|floatformat:0 }}%</h5>
                        <p class="text-muted">Best Score</p>
                    </div>
                    <div class="col-md-3">
                        <div class="feature-icon">
                            <i class="fas fa-clock text-info"></i>
                        </div>
                        <h5>{{ total_time|floatformat:0 }}</h5>
                        <p class="text-muted">Minutes Practiced</p>
                    </div>
                    <div class="col-md-3">
                        <div class="feature-icon">
                            <i class="fas fa-medal text-primary"></i>
                        </div>
                        <h5>{{ mastered_count }}</h5>
                        <p class="text-muted">Mastered</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body text-center">
                <h4><span class="emoji">üí°</span> Learning Tips</h4>
                <div class="row">
                    <div class="col-md-4">
                        <div class="feature-icon">
                            <i class="fas fa-target"></i>
                        </div>
                        <h6>Set Goals</h6>
                        <p>Try to complete at least one exercise each day!</p>
                    </div>
                    <div class="col-md-4">
                        <div class="feature-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <h6>Stay Positive</h6>
                        <p>Remember, practice makes perfect! Don't give up!</p>
                    </div>
                    <div class="col-md-4">
                        <div class="feature-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h6>Ask for Help</h6>
                        <p>Don't hesitate to ask teachers or parents for help!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize progress bars
        document.querySelectorAll('.progress-bar[data-progress]').forEach(function (bar) {
            const progress = bar.getAttribute('data-progress');
            bar.style.width = progress + '%';
        });

        // Card navigation
        document.querySelectorAll('.exercise-card').forEach(card => {
            card.addEventListener('click', function (e) {
                // Don't navigate if a button or link inside the card was clicked
                if (e.target.closest('a, button')) return;

                const url = this.getAttribute('data-url');
                if (url) location.href = url;
            });

            card.addEventListener('mouseenter', function () {
                this.style.transform = 'translateY(-5px)';
            });

            card.addEventListener('mouseleave', function () {
                this.style.transform = 'translateY(0)';
            });
        });
    });
</script>
{% endblock %}